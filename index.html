<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>VIT Academic Assistant</title>
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #e3eaff 0%, #fffbe9 100%);
      --sidebar-bg: #23262f;
      --sidebar-text: #f6f6fa;
      --sidebar-hover-bg: #353744;
      --active-convo-bg: #41445a;
      --user-msg-bg: linear-gradient(90deg, #307afe, #2de2ec);
      --user-msg-color: #fff;
      --bot-msg-bg: #f3f7ff;
      --bot-msg-color: #23262f;
      --border-color: #e6e6ea;
      --font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      --radius: 16px;
      --shadow: 0 4px 16px rgba(44, 62, 80, 0.13);
    }

    body {
      margin: 0;
      font-family: var(--font-family);
      background: var(--bg-gradient);
      display: flex;
      min-height: 100vh;
      overflow: auto;
    }

    /* Sidebar */
    #sidebar {
      width: 264px;
      background: var(--sidebar-bg);
      color: var(--sidebar-text);
      display: flex;
      flex-direction: column;
      padding: 12px 0;
      box-shadow: 2px 0 12px rgba(44, 62, 80, 0.08);
      transition: margin-left 0.3s;
      z-index: 10;
    }

    #sidebar .profile {
      margin: 24px 0 8px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #sidebar .profile img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(44, 62, 80, 0.12);
    }

    #new-chat-btn {
      margin: 0 16px 12px;
      padding: 14px;
      border: none;
      border-radius: var(--radius);
      background: #353744;
      color: var(--sidebar-text);
      font-size: 1rem;
      cursor: pointer;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
    }

    #new-chat-btn:hover {
      background: #41445a;
    }

    #conversation-list {
      margin: 0 8px;
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .conversation-item {
      border-radius: var(--radius);
      padding: 12px 14px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: background 0.2s, transform 0.1s;
    }

    .conversation-item:hover {
      background: var(--sidebar-hover-bg);
      transform: scale(1.02);
    }

    .conversation-item.active {
      background: var(--active-convo-bg);
      font-weight: 600;
    }

    .delete-btn {
      opacity: 0;
      font-size: 18px;
      color: #ff4d4f;
      border: none;
      background: none;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .conversation-item:hover .delete-btn {
      opacity: 1;
    }

    /* Chat area */
    #chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(255, 255, 255, 0.62);
      box-shadow: 0 0 30px rgba(135, 160, 255, 0.13);
      position: relative;
    }

    #chat-header {
      height: 56px;
      padding: 0 22px;
      border-bottom: 1px solid var(--border-color);
      font-size: 1.28rem;
      font-weight: 600;
      color: #234;
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.82);
    }

    #chat-history {
      flex: 1;
      overflow-y: auto;
      padding: 26px 30px 18px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .message {
      display: flex;
      align-items: flex-end;
      gap: 6px;
      animation: fadein 0.2s;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .avatar.user {
      background: #2de2ec;
    }

    .avatar.bot {
      background: #f2f6ff;
    }

    .bubble {
      padding: 12px 18px;
      border-radius: var(--radius);
      box-shadow: 0 2px 14px rgba(80, 90, 120, 0.08);
      font-size: 1rem;
      line-height: 1.54;
      max-width: 74vw;
      position: relative;
      word-break: break-word;
    }

    .user .bubble {
      background: var(--user-msg-bg);
      color: var(--user-msg-color);
      margin-left: auto;
    }

    .bot .bubble {
      background: var(--bot-msg-bg);
      color: var(--bot-msg-color);
    }

    .timestamp {
      font-size: 0.85rem;
      color: #9fa6b2;
      margin-top: 2px;
      align-self: flex-end;
    }

    #chat-input-area {
      padding: 18px 28px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 10px;
      align-items: center;
      background: rgba(255, 255, 255, 0.96);
    }

    #user-input {
      flex: 1;
      min-height: 48px;
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      padding: 10px 16px;
      font-size: 1rem;
      resize: none;
      transition: border 0.2s;
    }

    #user-input:focus {
      border-color: #307afe;
      outline: none;
    }

    #send-btn {
      background: linear-gradient(90deg, #307afe 60%, #2de2ec 100%);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      padding: 0 22px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      height: 46px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background 0.18s;
    }

    #send-btn:hover {
      background: linear-gradient(90deg, #257af0 48%, #1ccfc7 100%);
    }

    @keyframes fadein {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @media (max-width: 849px) {
      #sidebar {
        position: absolute;
        margin-left: -264px;
        height: 100vh;
      }

      #sidebar.visible {
        margin-left: 0;
      }

      #sidebar-toggle {
        display: block;
      }
    }
  </style>
</head>
<body>
  <aside id="sidebar">
    <div class="profile">
      <img src="https://ui-avatars.com/api/?name=User&background=2de2ec&color=fff" alt="User profile picture" />
      <span class="name">VIT Student</span>
    </div>
    <button id="new-chat-btn">âž• New Chat</button>
    <div id="conversation-list"></div>
  </aside>

  <main id="chat-area">
    <header id="chat-header">
      <button id="sidebar-toggle" aria-label="Toggle sidebar">â˜°</button>
      <span>VIT Academic Assistant</span>
    </header>
    <div id="chat-history"></div>
    <div id="chat-input-area">
      <textarea id="user-input" rows="1" maxlength="380" placeholder="Ask about courses, credits, etc..."></textarea>
      <button id="send-btn">Send âžœ</button>
    </div>
  </main>

  <script>
    const API_URL = "http://127.0.0.1:8000/api/chat";
    const STORAGE_KEY = "academicChatApp";

    const chatHistory = document.getElementById("chat-history");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const newChatBtn = document.getElementById("new-chat-btn");
    const conversationList = document.getElementById("conversation-list");

    let allConversations = {};
    let currentConversationId = null;

    const generateUUID = () => `id-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

    const saveData = () => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ allConversations, currentConversationId }));
    };

    const loadData = () => {
      const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
      allConversations = data.allConversations || {};
      currentConversationId = data.currentConversationId || null;
      if (!Object.keys(allConversations).length) startNewChat();
      renderSidebar();
      renderChatHistory();
    };

    const addMessage = (sender, text) => {
      const convo = allConversations[currentConversationId];
      convo.messages.push({ sender, text, timestamp: Date.now() });
      renderChatHistory();
      saveData();
    };

    const renderSidebar = () => {
      conversationList.innerHTML = "";
      const frag = document.createDocumentFragment();
      Object.values(allConversations)
        .sort((a, b) => b.id.localeCompare(a.id))
        .forEach(convo => {
          const div = document.createElement("div");
          div.className = `conversation-item${convo.id === currentConversationId ? " active" : ""}`;
          div.textContent = convo.title || "Untitled Chat";
          div.addEventListener("click", () => switchConversation(convo.id));
          frag.appendChild(div);
        });
      conversationList.appendChild(frag);
    };

    const renderChatHistory = () => {
      chatHistory.innerHTML = "";
      const convo = allConversations[currentConversationId];
      if (!convo) return;
      const frag = document.createDocumentFragment();
      convo.messages.forEach(msg => {
        const msgDiv = document.createElement("div");
        msgDiv.className = `message ${msg.sender}`;
        msgDiv.innerHTML = `
          <div class="avatar ${msg.sender}">${msg.sender === "user" ? "ðŸ‘¤" : "ðŸ¤–"}</div>
          <div class="bubble">${msg.text}</div>`;
        frag.appendChild(msgDiv);
      });
      chatHistory.appendChild(frag);
      chatHistory.scrollTop = chatHistory.scrollHeight;
    };

    async function handleSendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage("user", text);
      userInput.value = "";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: text }),
        });
        const data = await res.json();
        addMessage("bot", data.answer);
      } catch {
        addMessage("bot", "âš ï¸ Error: Could not fetch response.");
      }
    }

    const startNewChat = () => {
      const id = generateUUID();
      allConversations[id] = {
        id,
        title: "New Chat",
        messages: [{
          sender: "bot",
          text: "Hello! I'm your VIT Academic Assistant. How can I help you today?",
          timestamp: Date.now()
        }]
      };
      currentConversationId = id;
      saveData();
      renderSidebar();
      renderChatHistory();
    };

    const switchConversation = id => {
      currentConversationId = id;
      saveData();
      renderSidebar();
      renderChatHistory();
    };

    sendBtn.addEventListener("click", handleSendMessage);
    userInput.addEventListener("keypress", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSendMessage();
      }
    });
    newChatBtn.addEventListener("click", startNewChat);

    document.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>
